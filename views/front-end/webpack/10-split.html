<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>webpack的环境与代码分离 | __frank的博客</title>
    <meta name="generator" content="VuePress 1.9.7">
    <link rel="ico" href="/my-blog/favicon.ico">
    <script src="/my-blog/js/bodyClick.js"></script>
    <meta name="description" content="我的博客">
    <meta name="keywords" content="Vuepress博客  __frank">
    <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no">
    
    <link rel="preload" href="/my-blog/assets/css/0.styles.2660cd16.css" as="style"><link rel="preload" href="/my-blog/assets/js/app.4f38675c.js" as="script"><link rel="preload" href="/my-blog/assets/js/4.d2119a13.js" as="script"><link rel="preload" href="/my-blog/assets/js/1.dd8a5b18.js" as="script"><link rel="preload" href="/my-blog/assets/js/9.b0f91245.js" as="script"><link rel="prefetch" href="/my-blog/assets/js/10.23ebf418.js"><link rel="prefetch" href="/my-blog/assets/js/11.7a5625ee.js"><link rel="prefetch" href="/my-blog/assets/js/12.03ab554c.js"><link rel="prefetch" href="/my-blog/assets/js/13.d0021d7d.js"><link rel="prefetch" href="/my-blog/assets/js/14.44d4213b.js"><link rel="prefetch" href="/my-blog/assets/js/15.0e55d1fd.js"><link rel="prefetch" href="/my-blog/assets/js/16.2c4566b8.js"><link rel="prefetch" href="/my-blog/assets/js/17.dc439db4.js"><link rel="prefetch" href="/my-blog/assets/js/18.5d744b4f.js"><link rel="prefetch" href="/my-blog/assets/js/19.4a31a1a1.js"><link rel="prefetch" href="/my-blog/assets/js/20.5ebcf999.js"><link rel="prefetch" href="/my-blog/assets/js/21.89223e7f.js"><link rel="prefetch" href="/my-blog/assets/js/22.8facf3a4.js"><link rel="prefetch" href="/my-blog/assets/js/23.651ce128.js"><link rel="prefetch" href="/my-blog/assets/js/24.c77e07fd.js"><link rel="prefetch" href="/my-blog/assets/js/25.f58aa3c9.js"><link rel="prefetch" href="/my-blog/assets/js/26.c638b94e.js"><link rel="prefetch" href="/my-blog/assets/js/27.f55c649e.js"><link rel="prefetch" href="/my-blog/assets/js/28.c5f65549.js"><link rel="prefetch" href="/my-blog/assets/js/29.9fe631b5.js"><link rel="prefetch" href="/my-blog/assets/js/3.332ea4d4.js"><link rel="prefetch" href="/my-blog/assets/js/30.90e85369.js"><link rel="prefetch" href="/my-blog/assets/js/31.41817dc8.js"><link rel="prefetch" href="/my-blog/assets/js/32.62efe3c7.js"><link rel="prefetch" href="/my-blog/assets/js/33.82c2bafe.js"><link rel="prefetch" href="/my-blog/assets/js/34.c2ffc0e3.js"><link rel="prefetch" href="/my-blog/assets/js/35.3480b898.js"><link rel="prefetch" href="/my-blog/assets/js/36.4e4c1c64.js"><link rel="prefetch" href="/my-blog/assets/js/37.fa429b60.js"><link rel="prefetch" href="/my-blog/assets/js/38.a3b3debe.js"><link rel="prefetch" href="/my-blog/assets/js/39.99ae6c27.js"><link rel="prefetch" href="/my-blog/assets/js/40.022906d1.js"><link rel="prefetch" href="/my-blog/assets/js/41.e3782dcd.js"><link rel="prefetch" href="/my-blog/assets/js/42.09545bed.js"><link rel="prefetch" href="/my-blog/assets/js/43.c33b3ebb.js"><link rel="prefetch" href="/my-blog/assets/js/44.b18752b0.js"><link rel="prefetch" href="/my-blog/assets/js/45.f0de7349.js"><link rel="prefetch" href="/my-blog/assets/js/46.ee972246.js"><link rel="prefetch" href="/my-blog/assets/js/47.42a278f8.js"><link rel="prefetch" href="/my-blog/assets/js/48.5203bcc3.js"><link rel="prefetch" href="/my-blog/assets/js/49.caaec2b1.js"><link rel="prefetch" href="/my-blog/assets/js/5.ff82a2fb.js"><link rel="prefetch" href="/my-blog/assets/js/50.f9776d7e.js"><link rel="prefetch" href="/my-blog/assets/js/51.d44d3cde.js"><link rel="prefetch" href="/my-blog/assets/js/52.658c3041.js"><link rel="prefetch" href="/my-blog/assets/js/53.ed664972.js"><link rel="prefetch" href="/my-blog/assets/js/54.45469422.js"><link rel="prefetch" href="/my-blog/assets/js/55.14529b46.js"><link rel="prefetch" href="/my-blog/assets/js/56.7ed893be.js"><link rel="prefetch" href="/my-blog/assets/js/57.a626d132.js"><link rel="prefetch" href="/my-blog/assets/js/58.4347a4f9.js"><link rel="prefetch" href="/my-blog/assets/js/59.4fe8b74a.js"><link rel="prefetch" href="/my-blog/assets/js/6.85f79383.js"><link rel="prefetch" href="/my-blog/assets/js/60.23352f79.js"><link rel="prefetch" href="/my-blog/assets/js/61.41c8fd78.js"><link rel="prefetch" href="/my-blog/assets/js/62.c82993cb.js"><link rel="prefetch" href="/my-blog/assets/js/63.91bedd66.js"><link rel="prefetch" href="/my-blog/assets/js/64.cc86e4bf.js"><link rel="prefetch" href="/my-blog/assets/js/65.e1e8e4ab.js"><link rel="prefetch" href="/my-blog/assets/js/66.ff178ddd.js"><link rel="prefetch" href="/my-blog/assets/js/67.ab9d1fa0.js"><link rel="prefetch" href="/my-blog/assets/js/68.c84831c8.js"><link rel="prefetch" href="/my-blog/assets/js/69.f0beadc0.js"><link rel="prefetch" href="/my-blog/assets/js/7.c03050be.js"><link rel="prefetch" href="/my-blog/assets/js/70.bc7c1cbc.js"><link rel="prefetch" href="/my-blog/assets/js/71.3b867df2.js"><link rel="prefetch" href="/my-blog/assets/js/72.fd7a835e.js"><link rel="prefetch" href="/my-blog/assets/js/73.e3da65ef.js"><link rel="prefetch" href="/my-blog/assets/js/74.ad479cc3.js"><link rel="prefetch" href="/my-blog/assets/js/75.8412fcb7.js"><link rel="prefetch" href="/my-blog/assets/js/76.5db9d1d1.js"><link rel="prefetch" href="/my-blog/assets/js/77.c8757446.js"><link rel="prefetch" href="/my-blog/assets/js/78.48b8b666.js"><link rel="prefetch" href="/my-blog/assets/js/79.33464912.js"><link rel="prefetch" href="/my-blog/assets/js/8.a02a7995.js"><link rel="prefetch" href="/my-blog/assets/js/80.073c952e.js"><link rel="prefetch" href="/my-blog/assets/js/81.5be62b46.js"><link rel="prefetch" href="/my-blog/assets/js/82.b73fd900.js"><link rel="prefetch" href="/my-blog/assets/js/83.899c00ce.js"><link rel="prefetch" href="/my-blog/assets/js/84.75c419bc.js"><link rel="prefetch" href="/my-blog/assets/js/85.5781435e.js"><link rel="prefetch" href="/my-blog/assets/js/86.71e6b162.js"><link rel="prefetch" href="/my-blog/assets/js/87.e873c9a4.js"><link rel="prefetch" href="/my-blog/assets/js/88.4fac5fb0.js"><link rel="prefetch" href="/my-blog/assets/js/89.44315963.js"><link rel="prefetch" href="/my-blog/assets/js/90.97283a89.js">
    <link rel="stylesheet" href="/my-blog/assets/css/0.styles.2660cd16.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container" data-v-130b300a><div data-v-130b300a><div class="password-shadow password-wrapper-out" style="display:none;" data-v-25ba6db2 data-v-130b300a data-v-130b300a><h3 class="title" data-v-25ba6db2 data-v-25ba6db2>__frank的博客</h3> <p class="description" data-v-25ba6db2 data-v-25ba6db2>我的博客</p> <label id="box" class="inputBox" data-v-25ba6db2 data-v-25ba6db2><input type="password" value="" data-v-25ba6db2> <span data-v-25ba6db2>Konck! Knock!</span> <button data-v-25ba6db2>OK</button></label> <div class="footer" data-v-25ba6db2 data-v-25ba6db2><span data-v-25ba6db2><i class="iconfont reco-theme" data-v-25ba6db2></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-25ba6db2>vuePress-theme-reco</a></span> <span data-v-25ba6db2><i class="iconfont reco-copyright" data-v-25ba6db2></i> <a data-v-25ba6db2><span data-v-25ba6db2>__frank</span>
            
          <!---->
          2022
        </a></span></div></div> <div class="hide" data-v-130b300a><header class="navbar" data-v-130b300a><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/my-blog/" class="home-link router-link-active"><img src="/my-blog/avatar.jpg" alt="__frank的博客" class="logo"> <span class="site-name">__frank的博客</span></a> <div class="links"><div class="color-picker"><a class="color-button"><i class="iconfont reco-color"></i></a> <div class="color-picker-menu" style="display:none;"><div class="mode-options"><h4 class="title">Choose mode</h4> <ul class="color-mode-options"><li class="dark">dark</li><li class="auto active">auto</li><li class="light">light</li></ul></div></div></div> <div class="search-box"><i class="iconfont reco-search"></i> <input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/my-blog/" class="nav-link"><i class="iconfont reco-home"></i>
  主页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-category"></i>
      分类
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/my-blog/categories/计算机/" class="nav-link"><i class="undefined"></i>
  计算机
</a></li><li class="dropdown-item"><!----> <a href="/my-blog/categories/后端/" class="nav-link"><i class="undefined"></i>
  后端
</a></li><li class="dropdown-item"><!----> <a href="/my-blog/categories/前端/" class="nav-link"><i class="undefined"></i>
  前端
</a></li><li class="dropdown-item"><!----> <a href="/my-blog/categories/源码系列/" class="nav-link"><i class="undefined"></i>
  源码系列
</a></li><li class="dropdown-item"><!----> <a href="/my-blog/categories/工具/" class="nav-link"><i class="undefined"></i>
  工具
</a></li></ul></div></div><div class="nav-item"><a href="/my-blog/tag/" class="nav-link"><i class="iconfont reco-tag"></i>
  标签
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="fa fa-solid fa-sword"></i>
      内力修炼
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/my-blog/views/internal-forces/data-structure/01-stack.html" class="nav-link"><i class="undefined"></i>
  数据结构
</a></li><li class="dropdown-item"><!----> <a href="/my-blog/views/internal-forces/design-pattern/01-introduction.html" class="nav-link"><i class="undefined"></i>
  设计模式
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="fa fa-solid fa-code"></i>
      源码系列
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="http://47.111.91.121/vue-notes/" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="undefined"></i>
  vue2
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="/my-blog/views/source-code/vue3/01-entry.html" class="nav-link"><i class="undefined"></i>
  vue3
</a></li><li class="dropdown-item"><!----> <a href="/my-blog/views/source-code/webpack5/01-entry.html" class="nav-link"><i class="undefined"></i>
  webpack5
</a></li></ul></div></div><div class="nav-item"><a href="/my-blog/views/front-end/css/01-css.html" class="nav-link"><i class="fa fa-brands fa-css3"></i>
  奇妙的css
</a></div><div class="nav-item"><a href="/my-blog/timeline/" class="nav-link"><i class="iconfont reco-date"></i>
  时间轴
</a></div><div class="nav-item"><a href="/my-blog/about/" class="nav-link"><i class="iconfont reco-account"></i>
  关于
</a></div> <!----></nav></div></header> <div class="sidebar-mask" data-v-130b300a></div> <aside class="sidebar" data-v-130b300a><div class="personal-info-wrapper" data-v-39576ba9 data-v-130b300a><img src="/my-blog/avatar.jpg" alt="author-avatar" class="personal-img" data-v-39576ba9> <h3 class="name" data-v-39576ba9>
    __frank
  </h3> <div class="num" data-v-39576ba9><div data-v-39576ba9><h3 data-v-39576ba9>80</h3> <h6 data-v-39576ba9>Articles</h6></div> <div data-v-39576ba9><h3 data-v-39576ba9>19</h3> <h6 data-v-39576ba9>Tags</h6></div></div> <ul class="social-links" data-v-39576ba9><li class="social-item" data-v-39576ba9><i class="iconfont reco-github" style="color:#f47e60;" data-v-39576ba9></i></li><li class="social-item" data-v-39576ba9><i class="iconfont reco-npm" style="color:#67cc86;" data-v-39576ba9></i></li></ul> <hr data-v-39576ba9></div> <nav class="nav-links"><div class="nav-item"><a href="/my-blog/" class="nav-link"><i class="iconfont reco-home"></i>
  主页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-category"></i>
      分类
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/my-blog/categories/计算机/" class="nav-link"><i class="undefined"></i>
  计算机
</a></li><li class="dropdown-item"><!----> <a href="/my-blog/categories/后端/" class="nav-link"><i class="undefined"></i>
  后端
</a></li><li class="dropdown-item"><!----> <a href="/my-blog/categories/前端/" class="nav-link"><i class="undefined"></i>
  前端
</a></li><li class="dropdown-item"><!----> <a href="/my-blog/categories/源码系列/" class="nav-link"><i class="undefined"></i>
  源码系列
</a></li><li class="dropdown-item"><!----> <a href="/my-blog/categories/工具/" class="nav-link"><i class="undefined"></i>
  工具
</a></li></ul></div></div><div class="nav-item"><a href="/my-blog/tag/" class="nav-link"><i class="iconfont reco-tag"></i>
  标签
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="fa fa-solid fa-sword"></i>
      内力修炼
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/my-blog/views/internal-forces/data-structure/01-stack.html" class="nav-link"><i class="undefined"></i>
  数据结构
</a></li><li class="dropdown-item"><!----> <a href="/my-blog/views/internal-forces/design-pattern/01-introduction.html" class="nav-link"><i class="undefined"></i>
  设计模式
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="fa fa-solid fa-code"></i>
      源码系列
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="http://47.111.91.121/vue-notes/" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="undefined"></i>
  vue2
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="/my-blog/views/source-code/vue3/01-entry.html" class="nav-link"><i class="undefined"></i>
  vue3
</a></li><li class="dropdown-item"><!----> <a href="/my-blog/views/source-code/webpack5/01-entry.html" class="nav-link"><i class="undefined"></i>
  webpack5
</a></li></ul></div></div><div class="nav-item"><a href="/my-blog/views/front-end/css/01-css.html" class="nav-link"><i class="fa fa-brands fa-css3"></i>
  奇妙的css
</a></div><div class="nav-item"><a href="/my-blog/timeline/" class="nav-link"><i class="iconfont reco-date"></i>
  时间轴
</a></div><div class="nav-item"><a href="/my-blog/about/" class="nav-link"><i class="iconfont reco-account"></i>
  关于
</a></div> <!----></nav> <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>🎉 Webpack5笔记 🎉</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/my-blog/views/front-end/webpack/01-basic.html" class="sidebar-link">webpack基础</a></li><li><a href="/my-blog/views/front-end/webpack/02-browserslist.html" class="sidebar-link">浏览器兼容性工具</a></li><li><a href="/my-blog/views/front-end/webpack/03-plugin.html" class="sidebar-link">webpack常用Plugin</a></li><li><a href="/my-blog/views/front-end/webpack/04-module.html" class="sidebar-link">webpack模块化原理</a></li><li><a href="/my-blog/views/front-end/webpack/05-source-map.html" class="sidebar-link">webpack的source-map</a></li><li><a href="/my-blog/views/front-end/webpack/06-babel.html" class="sidebar-link">babel的使用</a></li><li><a href="/my-blog/views/front-end/webpack/07-typescript.html" class="sidebar-link">webpack使用TypeScript和ESlint</a></li><li><a href="/my-blog/views/front-end/webpack/08-DevServer-HMR.html" class="sidebar-link">DevServer和HMR</a></li><li><a href="/my-blog/views/front-end/webpack/09-path.html" class="sidebar-link">webpack的路径处理</a></li><li><a href="/my-blog/views/front-end/webpack/10-split.html" aria-current="page" class="active sidebar-link">webpack的环境与代码分离</a></li><li><a href="/my-blog/views/front-end/webpack/11-CDN-Shimming-DLL.html" class="sidebar-link">CDN-Shimming-DLL</a></li><li><a href="/my-blog/views/front-end/webpack/12-terser.html" class="sidebar-link">terser的使用</a></li><li><a href="/my-blog/views/front-end/webpack/13-Tree-Shaking.html" class="sidebar-link">Tree Shaking</a></li><li><a href="/my-blog/views/front-end/webpack/14-compression.html" class="sidebar-link">HTTP压缩和HTML压缩</a></li><li><a href="/my-blog/views/front-end/webpack/15-library.html" class="sidebar-link">webpack中封装库</a></li><li><a href="/my-blog/views/front-end/webpack/16-package-analysis.html" class="sidebar-link">webpack打包分析</a></li><li><a href="/my-blog/views/front-end/webpack/17-custom-loader.html" class="sidebar-link">自定义loader</a></li><li><a href="/my-blog/views/front-end/webpack/18-custom-plugin.html" class="sidebar-link">自定义plugin</a></li><li><a href="/my-blog/views/front-end/webpack/19-gulp.html" class="sidebar-link">Gulp的使用</a></li><li><a href="/my-blog/views/front-end/webpack/20-rollup.html" class="sidebar-link">Rollup的使用</a></li><li><a href="/my-blog/views/front-end/webpack/21-vite.html" class="sidebar-link">Vite的使用</a></li></ul></section></li></ul> </aside> <div class="password-shadow password-wrapper-in" style="display:none;" data-v-25ba6db2 data-v-130b300a><h3 class="title" data-v-25ba6db2 data-v-25ba6db2>webpack的环境与代码分离</h3> <!----> <label id="box" class="inputBox" data-v-25ba6db2 data-v-25ba6db2><input type="password" value="" data-v-25ba6db2> <span data-v-25ba6db2>Konck! Knock!</span> <button data-v-25ba6db2>OK</button></label> <div class="footer" data-v-25ba6db2 data-v-25ba6db2><span data-v-25ba6db2><i class="iconfont reco-theme" data-v-25ba6db2></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-25ba6db2>vuePress-theme-reco</a></span> <span data-v-25ba6db2><i class="iconfont reco-copyright" data-v-25ba6db2></i> <a data-v-25ba6db2><span data-v-25ba6db2>__frank</span>
            
          <!---->
          2022
        </a></span></div></div> <div data-v-130b300a><main class="page"><section><div class="page-title"><h1 class="title">webpack的环境与代码分离</h1> <div data-v-f875f3fc><i class="iconfont reco-account" data-v-f875f3fc><span data-v-f875f3fc>__frank</span></i> <i class="iconfont reco-date" data-v-f875f3fc><span data-v-f875f3fc>3/30/2022</span></i> <!----> <i class="tags iconfont reco-tag" data-v-f875f3fc><span class="tag-item" data-v-f875f3fc>webpack5</span></i></div></div> <div class="theme-reco-content content__default"><h2 id="环境分离"><a href="#环境分离" class="header-anchor">#</a> 环境分离</h2> <p>当webpack配置信息越来越多，<code>webpack.config.js</code>文件变得不易维护，某些配置在开发环境使用，某些配置在生产环境使用，那么如何对配置进行划分？下面介绍一种 <code>webpack</code> 配置环境分离的方式。</p> <ol><li>在文件根目录建立 <code>config</code> 文件，创建三个文件</li></ol> <ul><li><code>webpack.common.js</code>：通用配置</li> <li><code>webpack.dev.js</code>：开发环境配置</li> <li><code>webpack.prod.js</code>：生产环境配置</li></ul> <p><img src="/my-blog/assets/img/split1.57b0bff2.png" alt=""></p> <ol start="2"><li>在 <code>package.json</code> 进行如下配置，在启动命令时通过 <code>--env</code> 传入不同参数，即可对开发环境和生产环境进行区分</li></ol> <div class="language-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span>
    <span class="token property">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;serve&quot;</span><span class="token operator">:</span> <span class="token string">&quot;webpack serve --config ./config/webpack.common.js --env development&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;build&quot;</span><span class="token operator">:</span> <span class="token string">&quot;webpack --config ./config/webpack.common.js --env production&quot;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>在 <code>webpack.common.js</code> 进行配置，此时还是全部配置在一个文件，导出一个函数即可接收传递的参数</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;path&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> CleanWebpackPlugin <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;clean-webpack-plugin&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> HtmlWebpackPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;html-webpack-plugin&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">env</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;----------&quot;</span><span class="token punctuation">,</span> env<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">context</span><span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">&quot;./&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">//可以将context设置为config文件环境下</span>
        <span class="token literal-property property">entry</span><span class="token operator">:</span> <span class="token string">&quot;../src/index.js&quot;</span><span class="token punctuation">,</span> <span class="token comment">//入口文件路径则改为../</span>
        <span class="token literal-property property">output</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token literal-property property">filename</span><span class="token operator">:</span> <span class="token string">&quot;./js/index.js&quot;</span><span class="token punctuation">,</span> <span class="token comment">//打包后的文件名</span>
            <span class="token literal-property property">path</span><span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">&quot;../build&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">//必须使用绝对路径</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span>
            <span class="token keyword">new</span> <span class="token class-name">CleanWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token keyword">new</span> <span class="token class-name">HtmlWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                <span class="token literal-property property">title</span><span class="token operator">:</span> <span class="token string">&quot;webpack教程&quot;</span><span class="token punctuation">,</span>
                <span class="token literal-property property">template</span><span class="token operator">:</span> <span class="token string">&quot;../index.html&quot;</span><span class="token punctuation">,</span> <span class="token comment">//plugin中的路径也是一样</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><p>可以看到输出的参数有 <code>production: true</code></p> <p><img src="/my-blog/assets/img/split2.f3ce5c81.png" alt=""></p> <ol start="3"><li>然后判断哪些配置是开发环境哪些配置是生产环境，将代码拆分到对应文件</li></ol> <p><img src="/my-blog/assets/img/split3.79e9ad32.png" alt=""></p> <ul><li><code>webpack.common.js</code>:</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code>module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">env</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;----------&quot;</span><span class="token punctuation">,</span> env<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">context</span><span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">&quot;./&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">//可以将context设置为config文件环境下</span>
        <span class="token literal-property property">entry</span><span class="token operator">:</span> <span class="token string">&quot;../src/index.js&quot;</span><span class="token punctuation">,</span> <span class="token comment">//入口文件路径则改为../</span>
        <span class="token literal-property property">output</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token literal-property property">filename</span><span class="token operator">:</span> <span class="token string">&quot;./js/index.js&quot;</span><span class="token punctuation">,</span> <span class="token comment">//打包后的文件名</span>
            <span class="token literal-property property">path</span><span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">&quot;../build&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">//必须使用绝对路径</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span>
            <span class="token keyword">new</span> <span class="token class-name">HtmlWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                <span class="token literal-property property">title</span><span class="token operator">:</span> <span class="token string">&quot;webpack教程&quot;</span><span class="token punctuation">,</span>
                <span class="token literal-property property">template</span><span class="token operator">:</span> <span class="token string">&quot;../index.html&quot;</span><span class="token punctuation">,</span> <span class="token comment">//loader中的路径也是一样</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><ul><li><code>webpack.dev.js</code>:</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">mode</span><span class="token operator">:</span> <span class="token string">&quot;development&quot;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">devtool</span><span class="token operator">:</span> <span class="token string">&quot;source-map&quot;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">devServer</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">hot</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">//开启HMR</span>
        <span class="token literal-property property">client</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token literal-property property">overlay</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                <span class="token comment">//控制警告、错误信息是否在浏览器显示</span>
                <span class="token literal-property property">errors</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">//只有错误才在浏览器显示</span>
                <span class="token literal-property property">warnings</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><ul><li><code>webpack.prod.js</code>:</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token punctuation">{</span> CleanWebpackPlugin <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;clean-webpack-plugin&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">mode</span><span class="token operator">:</span> <span class="token string">&quot;production&quot;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token keyword">new</span> <span class="token class-name">CleanWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
   
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><ol start="4"><li>环境进行了分离，还需要进行合并，这里需要用到 <code>webpack-merge</code> 插件</li></ol> <div class="language- line-numbers-mode"><pre class="language-text"><code>npm i install webpack-merge -D
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>修改 <code>webpack.common.js</code>，根据环境来合并对应的代码</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token punctuation">{</span> merge <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;webpack-merge&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> DevConfig <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;./webpack.dev&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> ProdConfig <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;./webpack.prod&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> CommonConfig <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">context</span><span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">&quot;./&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">//可以将context设置为config文件环境下</span>
    <span class="token literal-property property">entry</span><span class="token operator">:</span> <span class="token string">&quot;../src/index.js&quot;</span><span class="token punctuation">,</span> <span class="token comment">//入口文件路径则改为../</span>
    <span class="token literal-property property">output</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">filename</span><span class="token operator">:</span> <span class="token string">&quot;./js/index.js&quot;</span><span class="token punctuation">,</span> <span class="token comment">//打包后的文件名</span>
        <span class="token literal-property property">path</span><span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">&quot;../build&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">//必须使用绝对路径</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token keyword">new</span> <span class="token class-name">HtmlWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            <span class="token literal-property property">title</span><span class="token operator">:</span> <span class="token string">&quot;webpack教程&quot;</span><span class="token punctuation">,</span>
            <span class="token literal-property property">template</span><span class="token operator">:</span> <span class="token string">&quot;../index.html&quot;</span><span class="token punctuation">,</span> <span class="token comment">//loader中的路径也是一样</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// 导出为函数，接收命令传递过来的参数</span>
module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">env</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;----------&quot;</span><span class="token punctuation">,</span> env<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> isProduction <span class="token operator">=</span> <span class="token operator">!</span><span class="token operator">!</span>env<span class="token punctuation">.</span>production<span class="token punctuation">;</span>
    <span class="token keyword">return</span> isProduction <span class="token operator">?</span> <span class="token function">merge</span><span class="token punctuation">(</span>CommonConfig<span class="token punctuation">,</span> ProdConfig<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token function">merge</span><span class="token punctuation">(</span>CommonConfig<span class="token punctuation">,</span> DevConfig<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br></div></div><ol start="5"><li>如果使用了 <code>babel</code>，有时候在 <code>babel.config.js</code> 中的插件也需要进行环境区分，因为在babel配置文件无法区分环境，我们可以利用Node的<code>process.env</code>来自己定义变量来区分环境，这样在<code>babel.config.js</code>中也能访问到</li></ol> <p>在 <code>webpack.common.js</code> 中设置变量 <code>process.env.NodeEnv</code>，在<code>babel.config.js</code>能够直接访问</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 导出为函数，接收命令传递过来的参数</span>
module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">env</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;----------&quot;</span><span class="token punctuation">,</span> env<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> isProduction <span class="token operator">=</span> <span class="token operator">!</span><span class="token operator">!</span>env<span class="token punctuation">.</span>production<span class="token punctuation">;</span>
    process<span class="token punctuation">.</span>env<span class="token punctuation">.</span>NodeEnv <span class="token operator">=</span> env<span class="token punctuation">.</span>production <span class="token operator">?</span> env<span class="token punctuation">.</span>production <span class="token operator">:</span><span class="token string">&quot;development&quot;</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> isProduction <span class="token operator">?</span> <span class="token function">merge</span><span class="token punctuation">(</span>CommonConfig<span class="token punctuation">,</span> ProdConfig<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token function">merge</span><span class="token punctuation">(</span>CommonConfig<span class="token punctuation">,</span> DevConfig<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h2 id="代码分离"><a href="#代码分离" class="header-anchor">#</a> 代码分离</h2> <p>代码分离是webpack一个非常重要的特性，它的主要目的是将代码分离到不同bundle中，之后我们可以按需加载，或者并行加载这些文件，提升首页加载的速度。webpack 中常用的代码分离有三种：</p> <ul><li>入口起点：使用entry配置手动分离代码</li> <li>防止重复：使用Entry Dependencies后者SplitChunksPlugin去重和代码分离</li> <li>动态导入：通过模块的内联函数调用来分离代码</li></ul> <h3 id="入口分离"><a href="#入口分离" class="header-anchor">#</a> 入口分离</h3> <p>最简单的代码分离就是通过设置多入口</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">context</span><span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">&quot;./&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">//可以将context设置为config文件环境下</span>
    <span class="token literal-property property">entry</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">main</span><span class="token operator">:</span> <span class="token string">&quot;../src/main.js&quot;</span><span class="token punctuation">,</span>
        <span class="token literal-property property">index</span><span class="token operator">:</span> <span class="token string">&quot;../src/index.js&quot;</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">output</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">filename</span><span class="token operator">:</span> <span class="token string">&quot;[name].bundle.js&quot;</span><span class="token punctuation">,</span> <span class="token comment">//打包后的文件名</span>
        <span class="token literal-property property">path</span><span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">&quot;../build&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">//必须使用绝对路径</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>打包后的文件：</p> <p><img src="/my-blog/assets/img/split4.d4f4125f.png" alt=""></p> <h3 id="防止重复"><a href="#防止重复" class="header-anchor">#</a> 防止重复</h3> <p>入口分离有如下缺点：</p> <ol><li>如果不同入口引用了重复的模块，哪些重复的模块都会被引入到各个 <code>bundle</code> 中</li> <li>不能动态的按照自己的需求从应用中将代码拆分出来</li></ol> <p>所以还存在下面两种方式解决以上问题</p> <h4 id="入口依赖-entry-dependencies"><a href="#入口依赖-entry-dependencies" class="header-anchor">#</a> 入口依赖（entry dependencies）</h4> <p>使用 <code>dependOn</code> 选项与其他入口共享模块</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">context</span><span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">&quot;./&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">//可以将context设置为config文件环境下</span>
    <span class="token literal-property property">entry</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token comment">// 不同入口依赖了相同模块，使用 dependOn 可以共享模块</span>
        <span class="token comment">// main: { import: &quot;../src/main.js&quot;, dependOn: &quot;lodash&quot;, /* filename:&quot;&quot; 这里也可以设置filename，不设置采用output.filename*/ },</span>
        <span class="token comment">// index: { import: &quot;../src/index.js&quot;, dependOn: &quot;lodash&quot; },</span>
        <span class="token comment">// lodash: &quot;lodash&quot;,</span>

        <span class="token comment">// 依赖了多个模块，可以将依赖模块打包到一个文件中进行共享</span>
        <span class="token literal-property property">main</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token keyword">import</span><span class="token operator">:</span> <span class="token string">&quot;../src/main.js&quot;</span><span class="token punctuation">,</span> <span class="token literal-property property">dependOn</span><span class="token operator">:</span> <span class="token string">&quot;shared&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token literal-property property">index</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token keyword">import</span><span class="token operator">:</span> <span class="token string">&quot;../src/index.js&quot;</span><span class="token punctuation">,</span> <span class="token literal-property property">dependOn</span><span class="token operator">:</span> <span class="token string">&quot;shared&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token literal-property property">shared</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;lodash&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;dayjs&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">output</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">filename</span><span class="token operator">:</span> <span class="token string">&quot;[name].bundle.js&quot;</span><span class="token punctuation">,</span> <span class="token comment">//打包后的文件名</span>
        <span class="token literal-property property">path</span><span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">&quot;../build&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">//必须使用绝对路径</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><p>打包后的文件：</p> <p>lodash模块打包成了一个 <code>lodash.bundle.js</code> 文件</p> <p><img src="/my-blog/assets/img/split5.82219052.png" alt=""></p> <p>多个模块打包成了一个 <code>shared.bundle.js</code></p> <p><img src="data:image/png;base64,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" alt=""></p> <h4 id="splitchunks"><a href="#splitchunks" class="header-anchor">#</a> splitChunks</h4> <p>另一种分包模式是<code>splitChunks</code>，它是使用 <code>SplitChunksPlugin</code> 来实现的，webpack已经默认集成了该插件。</p> <p>配置<code>optimization.splitChunks</code>：</p> <ul><li><code>chunks</code>：有三种取值，一般设置为 <code>all</code> 即可
<ul><li><code>initial</code>： 同步导入的模块进行拆分共享</li> <li><code>async</code>： 异步导入的模块进行拆分共享</li> <li><code>all</code>： 同步异步都进行拆分共享</li></ul></li> <li><code>minSize</code>：最小尺寸（ bytes），如果要拆分的模块小于这个值，则不会拆分</li> <li><code>maxSize</code>：将大于maxSize的部分，拆分成不小于minSize的包</li> <li><code>minChunks</code>： 一个包至少被导入了2次（在不同入口导入），才会进行拆分</li> <li><code>cacheGroups</code>：按条件分组，将匹配的模块打包到不同的chunk中</li></ul> <p>更多配置可查看 👉 <a href="https://webpack.docschina.org/plugins/split-chunks-plugin/#optimizationsplitchunks" target="_blank" rel="noopener noreferrer">splitChunks配置<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <div class="custom-block tip"><p class="title">提示</p><p>设置名称占位符<code>[id]</code>使用哪种算法生成：👉<a href="https://webpack.docschina.org/configuration/optimization/#optimizationchunkids" target="_blank" rel="noopener noreferrer">chunkIds<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></div><div class="language-js line-numbers-mode"><pre class="language-js"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">context</span><span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">&quot;./&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">//可以将context设置为config文件环境下</span>
    <span class="token literal-property property">entry</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">main</span><span class="token operator">:</span> <span class="token string">&quot;../src/main.js&quot;</span><span class="token punctuation">,</span>
        <span class="token literal-property property">index</span><span class="token operator">:</span> <span class="token string">&quot;../src/index.js&quot;</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">output</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">filename</span><span class="token operator">:</span> <span class="token string">&quot;[name].bundle.js&quot;</span><span class="token punctuation">,</span> <span class="token comment">//打包后的文件名</span>
        <span class="token literal-property property">path</span><span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">&quot;../build&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">//必须使用绝对路径</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">optimization</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">chunkIds</span><span class="token operator">:</span> <span class="token string">&quot;natural&quot;</span><span class="token punctuation">,</span> <span class="token comment">// id名称占位符使用哪种算法</span>
        <span class="token literal-property property">splitChunks</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token comment">// chunks: &quot;initial&quot;, //同步导入的模块进行拆分共享</span>
            <span class="token comment">// chunks: &quot;async&quot;, //异步导入的模块进行拆分共享</span>
            <span class="token literal-property property">chunks</span><span class="token operator">:</span> <span class="token string">&quot;all&quot;</span><span class="token punctuation">,</span> <span class="token comment">//同步异步都进行拆分共享</span>
            <span class="token comment">// 最小尺寸（ bytes），如果要拆分的模块小于这个值，则不会拆分</span>
            <span class="token literal-property property">minSize</span><span class="token operator">:</span> <span class="token number">200</span><span class="token punctuation">,</span>
            <span class="token comment">// 将大于maxSize的部分，拆分成不小于minSize的包</span>
            <span class="token comment">// maxSize: 30000,</span>
            <span class="token comment">// 一个包至少被导入了2次（在不同入口导入），才会进行拆分</span>
            <span class="token comment">// minChunks: 2,</span>
            <span class="token comment">/*
                cacheGroups：
                按条件分组，将匹配的模块打包到不同的chunk中
                不会立即将导入的模块进行输出，而是先缓存，等到所有匹配的模块加载完之后，再进行输出
            */</span>
            <span class="token literal-property property">cacheGroups</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                <span class="token comment">// 将node_modules下引用的模块，打包到一个chunk中</span>
                <span class="token literal-property property">vendor</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                    <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">[\\/]node_modules[\\/]</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
                    <span class="token literal-property property">filename</span><span class="token operator">:</span> <span class="token string">&quot;[id]_vendors.js&quot;</span><span class="token punctuation">,</span>
                    <span class="token literal-property property">priority</span><span class="token operator">:</span> <span class="token operator">-</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token comment">//vendor分组优先级更高</span>
                    <span class="token comment">// name:&quot;&quot; // name也可以设置打包的文件名称，可以是字符也可以是函数，与filename的区别就是，名字是固定的，不能使用名称占位符</span>
                <span class="token punctuation">}</span><span class="token punctuation">,</span>
                <span class="token comment">// 将名称为bar_开头的文件，打包到一个chunk中</span>
                <span class="token literal-property property">bar</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                    <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">bar_</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
                    <span class="token literal-property property">filename</span><span class="token operator">:</span><span class="token string">&quot;[id]_bar.js&quot;</span>
                <span class="token punctuation">}</span><span class="token punctuation">,</span>
                <span class="token comment">// 默认分组，被导入了2次会打包到一个chunk中</span>
                <span class="token comment">// 像lodash和dayjs满足既满足vendor分组也满足default，我们可以设置priority优先级</span>
                <span class="token comment">// default: {</span>
                <span class="token comment">//     minChunks: 2,</span>
                <span class="token comment">//     filename: &quot;[id]_common.js&quot;,</span>
                <span class="token comment">//     priority: -20,</span>
                <span class="token comment">// },</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br></div></div><p>打包后的文件：</p> <p><img src="/my-blog/assets/img/split7.feae7a18.png" alt=""></p> <h3 id="动态导入"><a href="#动态导入" class="header-anchor">#</a> 动态导入</h3> <p>另一种代码拆分方式是使用 <code>import()</code> 语法来实现动态导入动态导入，只要是异步导入的代码，webpack都会进行代码分离（即使splitChunks.chunks设置为initial）</p> <div class="custom-block tip"><p class="title"></p><p>如果有多个动态导入，不会在打包在一个文件内，会有多个chunk</p></div><p>在文件中使用</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">&quot;./foo&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>打包之后的文件：</p> <p><img src="/my-blog/assets/img/split8.f74444bc.png" alt=""></p> <p>还可以设置 <code>output.chunkFilename</code> 设置动态导入的文件名称，非动态导入的无法设置</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">output</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">filename</span><span class="token operator">:</span> <span class="token string">&quot;[name].bundle.js&quot;</span><span class="token punctuation">,</span> <span class="token comment">//打包后的文件名</span>
        <span class="token literal-property property">path</span><span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">&quot;../build&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">//必须使用绝对路径</span>
        <span class="token literal-property property">chunkFilename</span><span class="token operator">:</span> <span class="token string">&quot;./chunk/[name].chunk.js&quot;</span><span class="token punctuation">,</span> <span class="token comment">//异步加载打包的文件名</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>因为异步导入没有<code>name</code>占位符对应的值（会用 <code>id</code> 占位符进行替换），我们可以使用 <code>magic comments</code>（魔法注释）设置<code>name</code>占位符的值</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">import</span><span class="token punctuation">(</span><span class="token comment">/* webpackChunkName: &quot;foo&quot; */</span> <span class="token string">&quot;./foo&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>打包之后的文件：</p> <p><img src="/my-blog/assets/img/split9.3b6d6e74.png" alt=""></p> <h2 id="懒加载"><a href="#懒加载" class="header-anchor">#</a> 懒加载</h2> <p>在 <code>index.js</code> 添加一步导入代码</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> button <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">&quot;button&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
button<span class="token punctuation">.</span>innerText <span class="token operator">=</span> <span class="token string">&quot;加载元素&quot;</span><span class="token punctuation">;</span>
button<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&quot;click&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token comment">/* webpackChunkName: &quot;element&quot; */</span> <span class="token string">&quot;./element&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">;</span>
        document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>default<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>button<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>新建 <code>element.js</code>，新增一个div元素</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> element <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">&quot;div&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
element<span class="token punctuation">.</span>innerText <span class="token operator">=</span> <span class="token string">&quot;i am div&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> element<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p><strong>异步导入时的缺点</strong>：当点击按钮的时候，需要先下载js文件，浏览器再进行加载，如果文件很大，会造成页面卡顿。</p> <p><img src="/my-blog/assets/img/split10.846b928b.png" alt="">
点击后加载</p> <p><img src="/my-blog/assets/img/split11.e5cfebde.png" alt=""></p> <p>我们可以使用魔法注释 <code>prefetch</code> 和 <code>preload</code> 解决这个问题</p> <h3 id="prefetch"><a href="#prefetch" class="header-anchor">#</a> prefetch</h3> <p><code>prefetch</code>，预加载，等到浏览器空闲时，下载好js文件。</p> <p>在导入的地方添加魔法注释</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>button<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&quot;click&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token comment">/* webpackChunkName: &quot;element&quot; */</span> <span class="token comment">/* webpackPrefetch: true */</span>  <span class="token string">&quot;./element&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">;</span>
        document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>default<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>可以看到 <code>element.chunk.js</code> 先是预加载，然后点击按钮，直接拿取缓存</p> <p><img src="/my-blog/assets/img/split12.dfff2f3c.png" alt=""></p> <h3 id="preload"><a href="#preload" class="header-anchor">#</a> preload</h3> <p><code>preload</code>也是预加载，等到在父级块下载结束后再开始下载，而 <code>prefetch</code> 是等到浏览器空闲时下载，一般用 <code>prefetch</code> 更好</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>button<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&quot;click&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token comment">/* webpackChunkName: &quot;element&quot; */</span> <span class="token comment">/* webpackPreload: true */</span>  <span class="token string">&quot;./element&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">;</span>
        document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>default<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h2 id="提取运行时代码"><a href="#提取运行时代码" class="header-anchor">#</a> 提取运行时代码</h2> <p>什么是运行时相关代码？
形如 <code>import('abc').then(res=&gt;{})</code> 这种异步加载的代码，在 <code>webpack</code> 中即为运行时代码</p> <p>通过 <code>optimization.runtimeChunk</code> 即可抽离出运行时代码，打包成一个单独的文件</p> <p><code>runtimeChunk</code> 可以设置成如下值</p> <ul><li><code>true | multiple</code>：每个入口都会提取出一个 <code>runtime</code> 文件</li> <li><code>single</code>：多个入口也只会生成一个<code>runtime</code> 文件</li> <li><code>{ name }</code>：用于设置<code>runtime</code>文件<code>name</code>占位符名称</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">context</span><span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">&quot;./&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">//可以将context设置为config文件环境下</span>
    <span class="token literal-property property">entry</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">main</span><span class="token operator">:</span> <span class="token string">&quot;../src/main.js&quot;</span><span class="token punctuation">,</span>
        <span class="token literal-property property">index</span><span class="token operator">:</span> <span class="token string">&quot;../src/index.js&quot;</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">output</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">filename</span><span class="token operator">:</span> <span class="token string">&quot;[name].[hash:6].bundle.js&quot;</span><span class="token punctuation">,</span> <span class="token comment">//打包后的文件名</span>
        <span class="token literal-property property">path</span><span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">&quot;../build&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">//必须使用绝对路径</span>
        <span class="token literal-property property">chunkFilename</span><span class="token operator">:</span> <span class="token string">&quot;./chunk/[name].[hash:6].chunk.js&quot;</span><span class="token punctuation">,</span> <span class="token comment">//异步加载的</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">optimization</span><span class="token operator">:</span> <span class="token punctuation">{</span> 
        <span class="token literal-property property">chunkIds</span><span class="token operator">:</span> <span class="token string">&quot;natural&quot;</span><span class="token punctuation">,</span> <span class="token comment">// id名称占位符使用哪种算法</span>
        <span class="token comment">// runtimeChunk: true,</span>
        <span class="token comment">// runtimeChunk: {</span>
        <span class="token comment">//     name: &quot;runtime&quot;, //可以设置[name]字符占位名称的值</span>
        <span class="token comment">// },</span>
        <span class="token literal-property property">runtimeChunk</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token function-variable function">name</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">entrypoint</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">runtime-</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>entrypoint<span class="token punctuation">.</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> <span class="token comment">// entrypoint为入口文件的信息</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><p>打包后的文件：</p> <p><img src="/my-blog/assets/img/split13.5c6c3b09.png" alt=""></p> <h2 id="提取css代码"><a href="#提取css代码" class="header-anchor">#</a> 提取css代码</h2> <p>安装<code>mini-css-extract-plugin</code>插件，将css资源单独提取出来</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>npm i mini-css-extract-plugin -D
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>在生产环境 <code>webpack.prod.js</code>中进行配置，开发环境中可以不用提取</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> MiniCssExtractPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;mini-css-extract-plugin&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">mode</span><span class="token operator">:</span> <span class="token string">&quot;production&quot;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">module</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">rules</span><span class="token operator">:</span> <span class="token punctuation">[</span>
            <span class="token punctuation">{</span>
                <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.css</span><span class="token regex-delimiter">/</span><span class="token regex-flags">i</span></span><span class="token punctuation">,</span>
                <span class="token literal-property property">use</span><span class="token operator">:</span> <span class="token punctuation">[</span>MiniCssExtractPlugin<span class="token punctuation">.</span>loader<span class="token punctuation">,</span> <span class="token string">&quot;css-loader&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">//替换掉style-loader</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token keyword">new</span> <span class="token class-name">MiniCssExtractPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            <span class="token literal-property property">filename</span><span class="token operator">:</span> <span class="token string">&quot;./css/[name].[hash:6].css&quot;</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div></div></section> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated: </span> <span class="time">6/8/2022, 12:01:29 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev"><a href="/my-blog/views/front-end/webpack/09-path.html" class="prev">
            webpack的路径处理
          </a></span> <span class="next"><a href="/my-blog/views/front-end/webpack/11-CDN-Shimming-DLL.html">
            CDN-Shimming-DLL
          </a></span></p></div> <div class="comments-wrapper"><!----></div> <ul class="side-bar sub-sidebar-wrapper" style="width:12rem;" data-v-cb1513f6><li class="level-2" data-v-cb1513f6><a href="/my-blog/views/front-end/webpack/10-split.html#环境分离" class="sidebar-link reco-side-环境分离" data-v-cb1513f6>环境分离</a></li><li class="level-2" data-v-cb1513f6><a href="/my-blog/views/front-end/webpack/10-split.html#代码分离" class="sidebar-link reco-side-代码分离" data-v-cb1513f6>代码分离</a></li><li class="level-3" data-v-cb1513f6><a href="/my-blog/views/front-end/webpack/10-split.html#入口分离" class="sidebar-link reco-side-入口分离" data-v-cb1513f6>入口分离</a></li><li class="level-3" data-v-cb1513f6><a href="/my-blog/views/front-end/webpack/10-split.html#防止重复" class="sidebar-link reco-side-防止重复" data-v-cb1513f6>防止重复</a></li><li class="level-3" data-v-cb1513f6><a href="/my-blog/views/front-end/webpack/10-split.html#动态导入" class="sidebar-link reco-side-动态导入" data-v-cb1513f6>动态导入</a></li><li class="level-2" data-v-cb1513f6><a href="/my-blog/views/front-end/webpack/10-split.html#懒加载" class="sidebar-link reco-side-懒加载" data-v-cb1513f6>懒加载</a></li><li class="level-3" data-v-cb1513f6><a href="/my-blog/views/front-end/webpack/10-split.html#prefetch" class="sidebar-link reco-side-prefetch" data-v-cb1513f6>prefetch</a></li><li class="level-3" data-v-cb1513f6><a href="/my-blog/views/front-end/webpack/10-split.html#preload" class="sidebar-link reco-side-preload" data-v-cb1513f6>preload</a></li><li class="level-2" data-v-cb1513f6><a href="/my-blog/views/front-end/webpack/10-split.html#提取运行时代码" class="sidebar-link reco-side-提取运行时代码" data-v-cb1513f6>提取运行时代码</a></li><li class="level-2" data-v-cb1513f6><a href="/my-blog/views/front-end/webpack/10-split.html#提取css代码" class="sidebar-link reco-side-提取css代码" data-v-cb1513f6>提取css代码</a></li></ul></main> <!----></div></div></div></div><div class="global-ui"><div class="back-to-ceiling" style="right:1rem;bottom:6rem;width:2.5rem;height:2.5rem;border-radius:.25rem;line-height:2.5rem;display:none;" data-v-c6073ba8 data-v-c6073ba8><svg t="1574745035067" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5404" class="icon" data-v-c6073ba8><path d="M526.60727968 10.90185116a27.675 27.675 0 0 0-29.21455937 0c-131.36607665 82.28402758-218.69155461 228.01873535-218.69155402 394.07834331a462.20625001 462.20625001 0 0 0 5.36959153 69.94390903c1.00431239 6.55289093-0.34802892 13.13561351-3.76865779 18.80351572-32.63518765 54.11355614-51.75690182 118.55860487-51.7569018 187.94566865a371.06718723 371.06718723 0 0 0 11.50484808 91.98906777c6.53300375 25.50556257 41.68394495 28.14064038 52.69160883 4.22606766 17.37162448-37.73630017 42.14135425-72.50938081 72.80769204-103.21549295 2.18761121 3.04276886 4.15646224 6.24463696 6.40373557 9.22774369a1871.4375 1871.4375 0 0 0 140.04691725 5.34970492 1866.36093723 1866.36093723 0 0 0 140.04691723-5.34970492c2.24727335-2.98310674 4.21612437-6.18497483 6.3937923-9.2178004 30.66633723 30.70611158 55.4360664 65.4791928 72.80769147 103.21549355 11.00766384 23.91457269 46.15860503 21.27949489 52.69160879-4.22606768a371.15156223 371.15156223 0 0 0 11.514792-91.99901164c0-69.36717486-19.13165746-133.82216804-51.75690182-187.92578088-3.42062944-5.66790279-4.76302748-12.26056868-3.76865837-18.80351632a462.20625001 462.20625001 0 0 0 5.36959269-69.943909c-0.00994388-166.08943902-87.32547796-311.81420293-218.6915546-394.09823051zM605.93803103 357.87693858a93.93749974 93.93749974 0 1 1-187.89594924 6.1e-7 93.93749974 93.93749974 0 0 1 187.89594924-6.1e-7z" p-id="5405" data-v-c6073ba8></path><path d="M429.50777625 765.63860547C429.50777625 803.39355007 466.44236686 1000.39046097 512.00932183 1000.39046097c45.56695499 0 82.4922232-197.00623328 82.5015456-234.7518555 0-37.75494459-36.9345906-68.35043303-82.4922232-68.34111062-45.57627738-0.00932239-82.52019037 30.59548842-82.51086798 68.34111062z" p-id="5406" data-v-c6073ba8></path></svg></div><!----><div class="RibbonAnimation"></div></div></div>
    <script src="/my-blog/assets/js/app.4f38675c.js" defer></script><script src="/my-blog/assets/js/4.d2119a13.js" defer></script><script src="/my-blog/assets/js/1.dd8a5b18.js" defer></script><script src="/my-blog/assets/js/9.b0f91245.js" defer></script>
  </body>
</html>
